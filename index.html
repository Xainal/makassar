<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Harga Sayur Grosir</title>

<style>
:root{
  --bg:#f5f5f7;
  --card:#fff;
  --text:#111;
  --muted:#666;
  --line:#ddd;
  --accent:#111;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:1100px;
  margin:auto;
  padding:16px;
}

h1{
  margin:0 0 6px;
  font-size:clamp(20px,4.5vw,28px);
}

.sub{
  font-size:13px;
  color:var(--muted);
  margin-bottom:14px;
}

.section{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
  margin-bottom:14px;
}

label{font-size:13px}

input,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  outline:none;
  background:#fff;
}

button{
  padding:10px 12px;
  border-radius:10px;
  border:none;
  font-weight:800;
  cursor:pointer;
}

.btn{background:var(--accent);color:#fff}
.btn-light{background:#eee}

.flex{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.field{
  flex:1;
  min-width:180px;
}

@media(max-width:640px){
  .field{min-width:100%}
  button{width:100%}
}

/* ===== DESKTOP TABLE ===== */
.table-wrap{overflow:auto}
table{width:100%;border-collapse:collapse}
th,td{
  padding:14px;
  border-bottom:1px solid var(--line);
}
th{background:#fafafa;text-align:left}
.num{text-align:right;font-variant-numeric:tabular-nums}

/* ===== MOBILE CARD LIST ===== */
.mobile-list{display:none}

.card{
  background:#fff;
  border-radius:12px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 1px 6px rgba(0,0,0,.08);
}

.card-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:14px;
}

.card .name{
  font-size:16px;
  font-weight:800;
}

.card .price{
  font-size:16px;
  font-weight:900;
  white-space:nowrap;
}

.card .unit{
  font-size:12px;
  color:var(--muted);
  margin-top:6px;
}

/* switch view */
@media(max-width:640px){
  .table-wrap{display:none}
  .mobile-list{display:block}
}
</style>
</head>

<body>
<div class="container">

  <h1>Harga Sayur Grosir</h1>
  <div class="sub">
    Harga per <b>kantong</b> • Update harian
    <span id="lastUpdate"></span>
  </div>

  <!-- Controls -->
  <div class="section">
    <div class="flex">
      <div class="field">
        <label>Cari Komoditas</label>
        <input id="search" placeholder="tomat, cabe, buncis...">
      </div>

      <div class="field">
        <label>Tanggal</label>
        <input type="date" id="date">
      </div>

      <div class="field">
        <button class="btn" onclick="openUpdate()">Update Harga</button>
      </div>

      <div class="field">
        <button class="btn-light" onclick="exportCSV()">Export CSV</button>
      </div>
    </div>
  </div>

  <!-- DESKTOP TABLE -->
  <div class="section table-wrap">
    <table>
      <thead>
        <tr>
          <th>Komoditas</th>
          <th class="num">Harga / Kantong</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <!-- MOBILE LIST -->
  <div class="mobile-list" id="mobileList"></div>

</div>

<!-- MODAL -->
<div id="modalBg" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);align-items:center;justify-content:center;padding:16px">
  <div style="background:#fff;border-radius:14px;padding:16px;max-width:420px;width:100%">
    <h3 style="margin:0 0 10px">Update Harga</h3>

    <label>Komoditas</label>
    <select id="mCommodity"></select>

    <label style="margin-top:10px">Harga (Rp / kantong)</label>
    <input id="mPrice" type="number" min="0" inputmode="numeric">

    <div class="flex" style="margin-top:14px">
      <button class="btn-light" onclick="closeModal()">Batal</button>
      <button class="btn" onclick="savePrice()">Simpan</button>
    </div>
  </div>
</div>

<script>
const COMMODITIES=[
  "Tomat","Cabe Keriting Merah","Cabe Keriting Hijau",
  "Daun Bawang","Sawi Putih","Wortel Super",
  "Wortel Cakar","Buncis"
];

const KEY="HARGA_SAYUR_FINAL";

let state=JSON.parse(localStorage.getItem(KEY)||"null")||{
  date:new Date().toISOString().slice(0,10),
  lastUpdate:null,
  prices:{}
};

function save(){localStorage.setItem(KEY,JSON.stringify(state))}
function rp(n){return "Rp "+Number(n||0).toLocaleString("id-ID")}

function seed(){
  COMMODITIES.forEach(n=>{
    if(state.prices[n]===undefined) state.prices[n]=0;
  });
  if(!state.date) state.date=new Date().toISOString().slice(0,10);
  save();
}

function render(){
  const q=(search.value||"").toLowerCase();
  let rows="", cards="";

  COMMODITIES.filter(n=>n.toLowerCase().includes(q))
  .forEach(name=>{
    const price=state.prices[name]||0;

    rows+=`
      <tr>
        <td><b>${name}</b></td>
        <td class="num"><b>${rp(price)}</b></td>
      </tr>`;

    cards+=`
      <div class="card">
        <div class="card-row">
          <div class="name">${name}</div>
          <div class="price">${rp(price)}</div>
        </div>
        <div class="unit">per kantong</div>
      </div>`;
  });

  tbody.innerHTML = rows || `<tr><td colspan="2" style="color:#666">Tidak ada data.</td></tr>`;
  mobileList.innerHTML = cards || `<div class="section" style="color:#666">Tidak ada data.</div>`;

  date.value = state.date;
  lastUpdate.textContent = state.lastUpdate ? " • Update: " + state.lastUpdate : "";
}

function openUpdate(){
  mCommodity.innerHTML = COMMODITIES.map(n=>`<option>${n}</option>`).join("");
  mCommodity.value = COMMODITIES[0];
  mPrice.value = state.prices[mCommodity.value]||0;
  modalBg.style.display="flex";
}

function closeModal(){modalBg.style.display="none"}

mCommodity.addEventListener("change",()=>{
  mPrice.value = state.prices[mCommodity.value]||0;
});

function savePrice(){
  const price = Number(mPrice.value||0);
  if(price < 0){ alert("Harga tidak boleh minus."); return; }
  state.prices[mCommodity.value]=price;
  state.lastUpdate=new Date().toLocaleString("id-ID");
  save();
  closeModal();
  render();
}

function exportCSV(){
  let csv="komoditas,harga_per_kantong\n";
  COMMODITIES.forEach(n=>{
    csv+=`"${n.replaceAll('"','""')}",${state.prices[n]||0}\n`;
  });
  const a=document.createElement("a");
  a.href="data:text/csv;charset=utf-8,"+encodeURI(csv);
  a.download=`harga-sayur-${state.date||"hari-ini"}.csv`;
  a.click();
}

search.addEventListener("input",render);
date.addEventListener("change",()=>{
  state.date=date.value;
  save();
  render();
});

modalBg.addEventListener("click",(e)=>{
  if(e.target===modalBg) closeModal();
});

seed();
render();
</script>
</body>
</html>
